generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["relationJoins"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model ajuste_inventario {
  id_ajuste      Int              @id @default(autoincrement())
  descripcion    String
  fecha_hora     DateTime?        @default(now()) @db.Timestamp(6)
  tipo           String           @db.Char(1)
  num_productos  Int
  estado         String?          @default("ACT") @db.Char(3)
  detalle_ajuste detalle_ajuste[]
}

model auditoria {
  id_auditoria       Int       @id @default(autoincrement())
  id_usuario         Int?
  fecha              DateTime? @default(now()) @db.Date
  hora               DateTime? @default(now()) @db.Time(6)
  accion             String
  tabla              String
  clave_registro     String?
  valores_anteriores String?
  descripcion        String?
  ip_maquina         String?
}

model canal_venta {
  id_canal    String    @id @db.Char(3)
  descripcion String
  estado      String?   @default("ACT") @db.Char(3)
  factura     factura[]
}

model carrito {
  id_carrito          String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  id_cliente          Int?
  session_id          String?           @db.VarChar(100)
  estado              String?           @default("ACT") @db.Char(3)
  subtotal            Decimal?          @default(0) @db.Decimal(14, 3)
  total               Decimal?          @default(0) @db.Decimal(14, 3)
  fecha_creacion      DateTime?         @default(now()) @db.Timestamp(6)
  fecha_actualizacion DateTime?         @db.Timestamp(6)
  cliente             cliente?          @relation(fields: [id_cliente], references: [id_cliente], onDelete: NoAction, onUpdate: NoAction)
  carrito_detalle     carrito_detalle[]
  factura             factura?
}

model carrito_detalle {
  id_carrito      String    @db.Uuid
  id_producto     String    @db.VarChar(7)
  cantidad        Int
  precio_unitario Decimal   @db.Decimal(14, 3)
  subtotal        Decimal   @db.Decimal(14, 3)
  fecha_agregado  DateTime? @default(now()) @db.Timestamp(6)
  carrito         carrito   @relation(fields: [id_carrito], references: [id_carrito], onDelete: Cascade, onUpdate: NoAction)
  producto        producto  @relation(fields: [id_producto], references: [id_producto], onDelete: NoAction, onUpdate: NoAction)

  @@id([id_carrito, id_producto])
}

model categoria_producto {
  id_prod_categoria Int        @id @default(autoincrement())
  nombre            String
  descripcion       String?
  activo            Boolean?   @default(true)
  marca             marca[]
  producto          producto[]
}

model categoria_promocion {
  id_prom_categoria Int         @id @default(autoincrement())
  nombre            String
  descripcion       String?
  activo            Boolean?    @default(true)
  promocion         promocion[]
}

model ciudad {
  id_ciudad   String      @id @db.Char(3)
  descripcion String
  cliente     cliente[]
  proveedor   proveedor[]
}

model cliente {
  id_cliente        Int                 @id @default(autoincrement())
  id_usuario        Int?                @unique
  ruc_cedula        String              @unique @db.VarChar(13)
  email             String?
  telefono          String?
  direccion         String?
  id_ciudad         String?             @db.Char(3)
  origen            String?             @default("POS") @db.Char(3)
  estado            String?             @default("ACT") @db.Char(3)
  fecha_creacion    DateTime?           @default(now()) @db.Timestamp(6)
  nombre1           String
  nombre2           String?
  apellido1         String
  apellido2         String?
  carrito           carrito[]
  ciudad            ciudad?             @relation(fields: [id_ciudad], references: [id_ciudad], onDelete: NoAction, onUpdate: NoAction)
  usuario           usuario?            @relation(fields: [id_usuario], references: [id_usuario], onUpdate: NoAction)
  factura           factura[]
  producto_favorito producto_favorito[]
}

model compra {
  id_compra      String           @id @default(dbgenerated("('C'::text || lpad((nextval('seq_compra'::regclass))::text, 6, '0'::text))")) @db.VarChar(7)
  id_proveedor   String           @db.VarChar(7)
  fecha          DateTime?        @default(now()) @db.Date
  subtotal       Decimal          @db.Decimal(14, 3)
  total          Decimal          @db.Decimal(14, 3)
  estado         String?          @default("PEN") @db.Char(3)
  proveedor      proveedor        @relation(fields: [id_proveedor], references: [id_proveedor], onDelete: NoAction, onUpdate: NoAction)
  detalle_compra detalle_compra[]
  recepcion      recepcion[]
}

model detalle_ajuste {
  id_ajuste         Int
  id_producto       String            @db.VarChar(7)
  cantidad          Int
  ajuste_inventario ajuste_inventario @relation(fields: [id_ajuste], references: [id_ajuste], onDelete: Cascade, onUpdate: NoAction)
  producto          producto          @relation(fields: [id_producto], references: [id_producto], onDelete: NoAction, onUpdate: NoAction)

  @@id([id_ajuste, id_producto])
}

model detalle_compra {
  id_compra      String   @db.VarChar(7)
  id_producto    String   @db.VarChar(7)
  cantidad       Int
  costo_unitario Decimal  @db.Decimal(14, 3)
  subtotal       Decimal  @db.Decimal(14, 3)
  compra         compra   @relation(fields: [id_compra], references: [id_compra], onDelete: Cascade, onUpdate: NoAction)
  producto       producto @relation(fields: [id_producto], references: [id_producto], onDelete: NoAction, onUpdate: NoAction)

  @@id([id_compra, id_producto])
}

model detalle_factura {
  id_factura      String   @db.VarChar(15)
  id_producto     String   @db.VarChar(7)
  cantidad        Int
  precio_unitario Decimal  @db.Decimal(14, 3)
  subtotal        Decimal  @db.Decimal(14, 3)
  factura         factura  @relation(fields: [id_factura], references: [id_factura], onDelete: Cascade, onUpdate: NoAction, map: "factura_detalle_id_factura_fkey")
  producto        producto @relation(fields: [id_producto], references: [id_producto], onDelete: NoAction, onUpdate: NoAction, map: "factura_detalle_id_producto_fkey")

  @@id([id_factura, id_producto], map: "factura_detalle_pkey")
}

model detalle_promocion {
  id_promocion Int
  id_producto  String    @db.VarChar(7)
  cantidad     Int
  es_principal Boolean   @default(false)
  orden        Int?
  producto     producto  @relation(fields: [id_producto], references: [id_producto], onDelete: Cascade, map: "fk_detalle_promocion_producto")
  promocion    promocion @relation(fields: [id_promocion], references: [id_promocion], onDelete: Cascade, map: "fk_detalle_promocion_promocion")

  @@id([id_promocion, id_producto], map: "pk_detalle_promocion")
  @@index([es_principal], map: "idx_detalle_promocion_es_principal")
  @@index([id_producto], map: "idx_detalle_promocion_producto")
}

model detalle_recepcion {
  id_recepcion        Int
  id_producto         String    @db.VarChar(7)
  cantidad_solicitada Int
  cantidad_recibida   Int
  producto            producto  @relation(fields: [id_producto], references: [id_producto], onDelete: NoAction, onUpdate: NoAction)
  recepcion           recepcion @relation(fields: [id_recepcion], references: [id_recepcion], onDelete: Cascade, onUpdate: NoAction)

  @@id([id_recepcion, id_producto])
}

model empleado {
  id_empleado    Int         @id @default(autoincrement())
  id_usuario     Int         @unique
  cedula         String      @unique @db.VarChar(13)
  telefono       String?
  id_rol         Int
  estado         String?     @default("ACT") @db.Char(3)
  fecha_creacion DateTime?   @default(now()) @db.Timestamp(6)
  nombre1        String
  nombre2        String?
  apellido1      String
  apellido2      String?
  rol            rol         @relation(fields: [id_rol], references: [id_rol], onDelete: NoAction, onUpdate: NoAction)
  usuario        usuario     @relation(fields: [id_usuario], references: [id_usuario], onDelete: Cascade, onUpdate: NoAction)
  factura        factura[]
  recepcion      recepcion[]
}

model factura {
  id_factura      String            @id @db.VarChar(15)
  id_canal        String            @db.Char(3)
  id_cliente      Int
  id_carrito      String?           @unique @db.Uuid
  id_empleado     Int?
  id_metodo_pago  Int
  id_iva          Int
  subtotal        Decimal           @db.Decimal(14, 3)
  total           Decimal           @db.Decimal(14, 3)
  estado          String?           @default("EMI") @db.Char(3)
  fecha_emision   DateTime?         @default(now()) @db.Timestamp(6)
  fecha_retiro    DateTime?         @db.Timestamp(6)
  detalle_factura detalle_factura[]
  canal_venta     canal_venta       @relation(fields: [id_canal], references: [id_canal], onDelete: NoAction, onUpdate: NoAction)
  carrito         carrito?          @relation(fields: [id_carrito], references: [id_carrito], onDelete: NoAction, onUpdate: NoAction)
  cliente         cliente           @relation(fields: [id_cliente], references: [id_cliente], onDelete: NoAction, onUpdate: NoAction)
  empleado        empleado?         @relation(fields: [id_empleado], references: [id_empleado], onDelete: NoAction, onUpdate: NoAction)
  iva             iva               @relation(fields: [id_iva], references: [id_iva], onDelete: NoAction, onUpdate: NoAction)
  metodo_pago     metodo_pago       @relation(fields: [id_metodo_pago], references: [id_metodo_pago], onDelete: NoAction, onUpdate: NoAction)
}

model iva {
  id_iva       Int       @id @default(autoincrement())
  porcentaje   Decimal   @db.Decimal(5, 2)
  fecha_inicio DateTime  @db.Date
  fecha_fin    DateTime? @db.Date
  estado       String    @db.Char(1)
  factura      factura[]
}

model marca {
  id_marca           Int                @id @default(autoincrement())
  nombre             String             @unique @db.VarChar(50)
  id_categoria       Int
  estado             String?            @default("ACT") @db.Char(3)
  imagen_url         String?
  categoria_producto categoria_producto @relation(fields: [id_categoria], references: [id_prod_categoria], onDelete: NoAction, onUpdate: NoAction)
  producto           producto[]
}

model metodo_pago {
  id_metodo_pago      Int       @id @default(autoincrement())
  codigo              String    @unique @db.VarChar(20)
  nombre              String
  disponible_pos      Boolean?  @default(true)
  disponible_web      Boolean?  @default(true)
  requiere_referencia Boolean?  @default(false)
  estado              String?   @default("ACT") @db.Char(3)
  factura             factura[]
}

model producto {
  id_producto                                        String                 @id @default(dbgenerated("('P'::text || lpad((nextval('seq_producto'::regclass))::text, 6, '0'::text))")) @db.VarChar(7)
  descripcion                                        String
  id_prod_categoria                                  Int?
  id_marca                                           Int?
  id_um_compra                                       String                 @db.Char(3)
  id_um_venta                                        String                 @db.Char(3)
  costo_promedio                                     Decimal?               @default(0) @db.Decimal(14, 3)
  precio_venta                                       Decimal                @db.Decimal(14, 3)
  saldo_inicial                                      Int?                   @default(0)
  saldo_actual                                       Int?
  volumen                                            Decimal?               @db.Decimal(10, 2)
  alcohol_vol                                        Decimal?               @db.Decimal(4, 2)
  origen                                             String?
  notas_cata                                         String?
  estado                                             String?                @default("ACT") @db.Char(3)
  codigo_barras                                      String?                @unique(map: "idx_producto_codigo_barras") @db.VarChar(50)
  imagen_url                                         String?
  carrito_detalle                                    carrito_detalle[]
  detalle_ajuste                                     detalle_ajuste[]
  detalle_compra                                     detalle_compra[]
  detalle_factura                                    detalle_factura[]
  detalle_promocion                                  detalle_promocion[]
  detalle_recepcion                                  detalle_recepcion[]
  categoria_producto                                 categoria_producto?    @relation(fields: [id_prod_categoria], references: [id_prod_categoria], onDelete: NoAction, onUpdate: NoAction, map: "producto_id_categoria_fkey")
  marca                                              marca?                 @relation(fields: [id_marca], references: [id_marca], onDelete: NoAction, onUpdate: NoAction)
  unidad_medida_producto_id_um_compraTounidad_medida unidad_medida          @relation("producto_id_um_compraTounidad_medida", fields: [id_um_compra], references: [id_unidad_medida], onDelete: NoAction, onUpdate: NoAction)
  unidad_medida_producto_id_um_ventaTounidad_medida  unidad_medida          @relation("producto_id_um_ventaTounidad_medida", fields: [id_um_venta], references: [id_unidad_medida], onDelete: NoAction, onUpdate: NoAction)
  producto_favorito                                  producto_favorito[]
  proveedor_x_producto                               proveedor_x_producto[]
}

model producto_favorito {
  id_cliente     Int
  id_producto    String    @db.VarChar(7)
  fecha_creacion DateTime? @default(now()) @db.Timestamp(6)
  cliente        cliente   @relation(fields: [id_cliente], references: [id_cliente], onDelete: Cascade, onUpdate: NoAction)
  producto       producto  @relation(fields: [id_producto], references: [id_producto], onDelete: NoAction, onUpdate: NoAction)

  @@id([id_cliente, id_producto])
}

model promocion {
  id_promocion            Int                 @id @default(autoincrement())
  id_prom_categoria       Int
  nombre                  String
  descripcion             String?
  descripcion_corta       String?
  precio_original         Decimal?            @db.Decimal(10, 2)
  precio_promocional      Decimal?            @db.Decimal(10, 2)
  porcentaje_descuento    Decimal?            @db.Decimal(5, 2)
  fecha_inicio            DateTime            @db.Timestamp(6)
  fecha_fin               DateTime            @db.Timestamp(6)
  stock_disponible        Int
  cantidad_vendida        Int?                @default(0)
  cantidad_maxima_cliente Int?
  estado                  Boolean?            @default(true)
  fecha_creacion          DateTime?           @default(now()) @db.Timestamp(6)
  detalle_promocion       detalle_promocion[]
  categoria_promocion     categoria_promocion @relation(fields: [id_prom_categoria], references: [id_prom_categoria], onDelete: NoAction, onUpdate: NoAction, map: "promocion_id_categoria_fkey")
}

model proveedor {
  id_proveedor         String                 @id @default(dbgenerated("('PR'::text || lpad((nextval('seq_proveedor'::regclass))::text, 5, '0'::text))")) @db.VarChar(7)
  ruc_cedula           String                 @unique @db.VarChar(13)
  razon_social         String
  telefono             String?
  email                String?
  direccion            String?
  id_ciudad            String                 @db.Char(3)
  estado               String?                @default("ACT") @db.Char(3)
  compra               compra[]
  ciudad               ciudad                 @relation(fields: [id_ciudad], references: [id_ciudad], onDelete: NoAction, onUpdate: NoAction)
  proveedor_x_producto proveedor_x_producto[]
}

model proveedor_x_producto {
  id_proveedor  String    @db.VarChar(7)
  id_producto   String    @db.VarChar(7)
  precio_compra Decimal?  @db.Decimal(14, 3)
  stock         Int?
  estado        Boolean?  @default(true)
  producto      producto  @relation(fields: [id_producto], references: [id_producto], onDelete: NoAction, onUpdate: NoAction, map: "proveedor_producto_id_producto_fkey")
  proveedor     proveedor @relation(fields: [id_proveedor], references: [id_proveedor], onDelete: NoAction, onUpdate: NoAction, map: "proveedor_producto_id_proveedor_fkey")

  @@id([id_proveedor, id_producto], map: "proveedor_producto_pkey")
}

model recepcion {
  id_recepcion      Int                 @id @default(autoincrement())
  id_compra         String?             @db.VarChar(7)
  id_empleado       Int?
  descripcion       String?
  fecha_hora        DateTime?           @default(now()) @db.Timestamp(6)
  estado            String?             @default("ACT") @db.Char(3)
  observaciones     String?
  motivo_anulacion  String?
  fecha_anulacion   DateTime?           @db.Timestamp(6)
  detalle_recepcion detalle_recepcion[]
  compra            compra?             @relation(fields: [id_compra], references: [id_compra], onDelete: NoAction, onUpdate: NoAction)
  empleado          empleado?           @relation(fields: [id_empleado], references: [id_empleado], onDelete: NoAction, onUpdate: NoAction)
}

model rol {
  id_rol      Int        @id @default(autoincrement())
  codigo      String     @unique @db.VarChar(20)
  nombre      String     @db.VarChar(50)
  descripcion String?
  estado      String?    @default("ACT") @db.Char(3)
  empleado    empleado[]
}

model unidad_medida {
  id_unidad_medida                              String     @id @db.Char(3)
  descripcion                                   String
  producto_producto_id_um_compraTounidad_medida producto[] @relation("producto_id_um_compraTounidad_medida")
  producto_producto_id_um_ventaTounidad_medida  producto[] @relation("producto_id_um_ventaTounidad_medida")
}

model usuario {
  id_usuario     Int       @id @default(autoincrement())
  usuario        String    @unique(map: "usuario_email_key")
  password_hash  String
  estado         String?   @default("ACT") @db.Char(3)
  fecha_creacion DateTime? @default(now()) @db.Timestamp(6)
  ultimo_acceso  DateTime? @db.Timestamp(6)
  cliente        cliente?
  empleado       empleado?
}
